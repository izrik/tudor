<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tudor - {{ task.summary if task.summary != None }}</title>
    <link rel="stylesheet" href="../static/tudor.css" />
</head>

<body>
<div>
    <table class="task_info">
        <tr><td>ID</td><td>{{ task.id }}</td></tr>
        <tr><td>Summary</td><td>{{ task.summary|d }}</td></tr>
        <tr><td>Description</td><td><div class="task_description">{{ task.description|gfm if task.description != None }}</div></td></tr>
        <tr><td>Deadline</td><td>{{ task.deadline|d }}</td></tr>
        <tr><td>Done?</td><td>{{ task.is_done }}</td></tr>
        <tr><td>Deleted?</td><td>{{ task.is_deleted }}</td></tr>
        <tr><td>Order #</td><td>{{ task.order_num if task.order_num != None }}</td></tr>
        <tr>
            <td>Parent Task</td>
            <td>
                {% if task.parent_id != None %}
                <a href="{{ url_for('view_task', id=task.parent_id) }}">{{ task.parent.summary if task.parent != None }} ({{ task.parent_id if task.parent_id != None }})</a>
                {% else %}
                None
                {% endif %}
            </td>
        </tr>
    </table>
    <p><a href="{{ url_for('edit_task', id=task.id) }}">edit</a></p>
</div>
<div>
    <p><a href="{{ url_for('index') }}">main</a></p>
</div>
<div>
    <h4>Child Tasks</h4>
    <table class="task_children">
        <thead>
        <tr>
            <th>ID</th>
            <th>Summary</th>
        </tr>
        </thead>
        {% for child in task.get_children(descending=True) %}
        <tr>
            <td><a href="{{ url_for('view_task', id=child.id) }}">{{ child.id }}</a></td>
            <td><a href="{{ url_for('view_task', id=child.id) }}">{{ child.summary }}{% if child.is_deleted %} (deleted){% endif %}</a></td>
        </tr>
        {% endfor %}
        <tfoot>
            <td></td>
            <td>
                <form action="/new" method="post">
                    <input type="text" name="summary" />
                    <input type="hidden" name="parent_id" value="{{ task.id }}" />
                    <input type="hidden" name="next_url" value="{{ url_for('view_task', id=task.id) }}" />
                </form>
            </td>
        </tfoot>
    </table>
</div>
<div>
    <h4>Notes</h4>
    <table class="task_notes">
        <thead>
        <tr>
            <th>ID</th>
            <th>Timestamp</th>
            <th>Content</th>
        </tr>
        </thead>
        {% for note in task.notes %}
        <tr>
            <td>{{ note.id }}</td>
            <td>{{ note.timestamp }}</td>
            <td class="note_content">{{ note.content|gfm if note.content != None }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td></td>
            <td></td>
            <td>
                <form action="{{ url_for('new_note', id=task.id) }}" method="post">
                    <textarea name="content"></textarea><br/>
                    <input type="submit" value="Add New Note">
                </form>
            </td>
        </tr>
    </table>

</div>
<div>
    <h4>Attachments</h4>
    <table class="task_attachments">
        <thead>
        <tr>
            <th>ID</th>
            <th>Timestamp</th>
            <th>Filename</th>
            <th>Description</th>
        </tr>
        </thead>
        {% for att in task.attachments %}
        <tr>
            <td>{{ att.id }}</td>
            <td>{{ att.timestamp }}</td>
            <td><a href="{{ url_for('get_attachment', id=task.id, aid=att.id, x=att.filename) }}">{{ att.filename if att.filename != None }}</a></td>
            <td>{{ att.description }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td></td>
            <td></td>
            <form action="{{ url_for('new_attachment', id=task.id) }}" method="post" enctype="multipart/form-data">
                <td>
                    <input type="file" name="filename" />
                </td>
                <td>
                    <input type="text" name="description" maxlength="100" />
                    <input type="submit" value="Attach" />
                </td>
            </form>
        </tr>
    </table>
</div>
</body>
</html>
