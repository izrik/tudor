{% extends "base.t.html" %}
{% block title %}{{ super() }} - New Loader Test - Task with children{% endblock %}
{% block content %}
<div>
    <table class="task_info">
        <tr><td>ID</td><td>{{ task.id }}</td></tr>
        <tr><td>Summary</td><td>{{ task.summary|d }}</td></tr>
        <tr><td>Description</td><td><div class="task_description">{{ task.description|gfm if task.description != None }}</div></td></tr>
        <tr><td>Deadline</td><td>{{ task.deadline|d }}</td></tr>
        <tr>
            <td>Done?</td>
            <td>{{ task.is_done }}
                <small>
                    {% if task.is_done %}
                        <a href="{{ url_for('task_undo', id=task.id, next=url_for('view_task', id=task.id)) }}">(mark as not done)</a>
                    {% else %}
                        <a href="{{ url_for('task_done', id=task.id, next=url_for('view_task', id=task.id)) }}">(mark as done)</a>
                    {% endif %}
                </small>
            </td>
        </tr>
        <tr>
            <td>Deleted?</td>
            <td>{{ task.is_deleted }}
                <small>
                    {% if task.is_deleted %}
                        <a href="{{ url_for('undelete_task', id=task.id, next=url_for('view_task', id=task.id)) }}">(undelete)</a>
                    {% else %}
                        <a href="{{ url_for('delete_task', id=task.id, next=url_for('view_task', id=task.id)) }}">(delete)</a>
                    {% endif %}
                </small>
            </td>
        </tr>
        <tr><td>Order #</td><td>{{ task.order_num if task.order_num != None }}</td></tr>
        <tr>
            <td>Parent Task</td>
            <td>
                {% if task.parent_id != None %}
                <a href="{{ url_for('new_loader_task_with_children', id=task.parent_id) }}">{{ task.parent.summary if task.parent != None }} ({{ task.parent_id if task.parent_id != None }})</a>
                {% else %}
                None
                {% endif %}
            </td>
        </tr>
    </table>
    <p><a href="{{ url_for('edit_task', id=task.id) }}">edit</a></p>
</div>
<div>
    <h4>Child Tasks</h4>
    <table class="task_children">
        {% set odd_even = cycle(['odd', 'even']).next %}
        <thead>
        <tr>
            <th>ID</th>
            <th>Summary</th>
            <th>Deadline</th>
            <th>Done?</th>
            <th>Deleted?</th>
            <th>Order #</th>
            <th>Parent ID</th>
            <th>Depth</th>
        </tr>
        </thead>
        {% for child in descendants if child != task %}
        <tr class="{{ odd_even() }}">
            <td><a href="{{ url_for('new_loader_task_with_children', id=child.id) }}">{{ child.id }}</a></td>
            <td style="padding-left: {{(child.depth-1)*1.5}}em" {{ child.get_css_class_attr()|safe }}>
                <a href="{{ url_for('new_loader_task_with_children', id=child.id) }}">{{ child.summary }}</a>
            </td>
            <td>{{ child.deadline }}</td>
            <td>{{ child.is_done }}</td>
            <td>{{ child.is_deleted }}</td>
            <td>{{ child.order_num }}</td>
            <td>{{ child.parent_id }}</td>
            <td>{{ child.depth }}</td>
        </tr>
        {% endfor %}
        <tfoot>
            <td></td>
            <td>
                <form action="{{ url_for('new_task') }}" method="post">
                    <input type="text" name="summary" />
                    <input type="hidden" name="parent_id" value="{{ task.id }}" />
                    <input type="hidden" name="next_url" value="{{ url_for('view_task', id=task.id) }}" />
                </form>
            </td>
        </tfoot>
    </table>
</div>

{% endblock %}